<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>TS Ingress Controller</title>
  

  <link rel="shortcut icon" href="./img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="./css/theme.css" type="text/css" />
  <link rel="stylesheet" href="./css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="./css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "None";
    var mkdocs_page_input_path = "index.md";
    var mkdocs_page_url = "/";
  </script>
  
  <script src="./js/jquery-2.1.1.min.js"></script>
  <script src="./js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="./js/highlight.pack.js"></script>
  <script src="./js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="." class="icon icon-home"> TS Ingress Controller</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href=".">Home</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#traffic-server-ingress-controller">Traffic Server ingress controller</a></li>
                
                    <li><a class="toctree-l4" href="#quick-start">Quick start</a></li>
                
                    <li><a class="toctree-l4" href="#known-bugs">Known bugs</a></li>
                
                    <li><a class="toctree-l4" href="#release-history">Release history</a></li>
                
                    <li><a class="toctree-l4" href="#license-and-credits">License and credits</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Installation</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="source/">Installing from source</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="docker/">Using the Docker Image</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="classes/">Using multiple Ingress controllers</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="config/">Configuration</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="domainaccess/">Domain access control</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Usage</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="annotations/">Annotations</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="caching/">Caching</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="auth/">Authentication</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="external/">External proxying</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="tls/">TLS</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="cors/">CORS</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="compression/">Compression</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="serverpush/">Server Push</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="debugging/">Debugging</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href=".">TS Ingress Controller</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".">Docs</a> &raquo;</li>
    
      
    
    <li>Home</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/torchbox/k8s-ts-ingress" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="traffic-server-ingress-controller">Traffic Server ingress controller</h1>
<p><em>Note</em>: This software is still in development.  While we are using it internally,
we do not recommend deploying it in a production cluster at this time.</p>
<p><a href="https://trafficserver.apache.org/">Traffic Server</a> is a high-performance,
extensible HTTP proxy server with a rich feature set, including TLS termination,
caching, and edge-side includes (ESI).  This plugin allows Traffic Server to
act as an <a href="https://github.com/kubernetes/ingress">Ingress</a> controller for
<a href="https://kubernetes.io">Kubernetes</a> clusters, providing the reverse proxy that
allows HTTP requests from the Internet to reach Kubernetes pods.</p>
<p>The controller is provided as C source code and as a pre-built Docker image.
If you want to add Kubernetes support to an existing instance of TS, you should
build the plugin from source.  If you want to deploy TS inside a Kubernetes
cluster, you can use the pre-built Docker image.</p>
<h2 id="quick-start">Quick start</h2>
<p>To deploy the image on an existing Kubernetes 1.6 (or later) cluster:</p>
<pre><code class="sh">$ curl -L https://raw.githubusercontent.com/torchbox/k8s-ts-ingress/master/example-rbac.yaml | kubectl apply -f -
$ curl -L https://raw.githubusercontent.com/torchbox/k8s-ts-ingress/master/example-deployment.yaml | kubectl apply -f -
</code></pre>

<p>(If you're using 1.5 or earlier, you can still use <code>example-deployment.yaml</code>,
but if you need RBAC support you will need to convert <code>example-rbac.yaml</code> to use
the old alpha RBAC API.)</p>
<p>This will start two copies of Traffic Server, each with an emptyDir volume for
cache storage, listening on node ports 30080 (http) and 30443 (https).   You can
configure an external load balancer of some sort to route incoming traffic to
those ports, or use Kubernetes'
<a href="https://github.com/kubernetes/contrib/tree/master/keepalived-vip">keepalived-vip</a>
to manage a virtual IP address on your cluster.</p>
<p>For more detailed installation instructions, see the documentation for
<a href="source/">building from source</a> or <a href="docker/">Deploying on Kubernetes</a>.</p>
<h2 id="known-bugs">Known bugs</h2>
<ul>
<li>A Traffic Server bug
  (<a href="https://github.com/apache/trafficserver/issues/2076">GH #2076</a>) causes
  incorrect processing of HTTP/2 PATCH requests which use chunked transfer 
  encoding.  Requests of this type are very unusual, but <code>docker push</code> has been
  observed to use them.  As a result, pushing to a private registry hosted
  behind the TS Ingress controller will fail with 503 Internal Server Error.
  Workaround: set the annotation <code>ingress.kubernetes.io/http2-enable: "false"</code>
  to disable HTTP/2 on the affected Ingress, or set
  <code>$PROXY_CONFIG_HTTP2_ENABLED</code> to <code>"0"</code> to disable HTTP/2 globally.</li>
</ul>
<h2 id="release-history">Release history</h2>
<ul>
<li>
<p>1.0.0-alpha10 (unreleased):</p>
<ul>
<li>Bug fix: if a domain was specified in <code>domain-access-list</code>, a later match
    for <code>*</code> or the same domain would be ignored.</li>
</ul>
</li>
<li>
<p>1.0.0-alpha9:</p>
<ul>
<li>Incompatible change: the Docker image now listens on ports 80 and 443 by
    default, instead of 7080 and 7443.</li>
<li>Feature: the <code>tls-minimum-version</code> annotation was implemented.</li>
<li>Feature: the global ConfigMap was implemented.</li>
<li>Feature: the <code>tls-certificates</code> ConfigMap option was implemented.</li>
<li>Feature: built-in TS healthchecks were implemented.</li>
<li>Feature: the <code>domain-access-list</code> ConfigMap option was implemented.</li>
<li>Improvement: the Docker image now sends log output to stdout, as
    expected in Docker.</li>
<li>Bug fix: a request for <code>/</code> on an Ingress which had <code>rewrite-target</code> set on
    its default path would crash.</li>
<li>Bug fix: annotations which are host-specific rather than path-specific
    (such as <code>hsts-max-age</code>) could be set wrongly.</li>
<li>Bug fix: if TS received an HTTP request before it had finished syncing the
    initial cluster state, it would leak memory.</li>
<li>Improvement: The plugin was added to Coverity SCAN.  As a result, several
    minor bugs were fixed and code quality was improved.</li>
</ul>
</li>
<li>
<p>1.0.0-alpha8:</p>
<ul>
<li>Incompatible change: The CORS configuration was changed to be both more
    clear and more flexible.</li>
<li>Feature: HTTP/2 Server Push was implemented.</li>
<li>Feature: the <code>cache-whitelist-cookies</code> annotation was implemented.</li>
<li>Feature: the <code>debug-log</code> annotation was implemented.</li>
<li>Feature: the <code>http2-enable</code> annotation was implemented.</li>
<li>Improvement: Two unnecessary plugins were removed from the Docker image
    configuration (header_rewrite and xdebug).</li>
<li>Improvement: End-to-end test coverage was improved; as a result, several
    bugs were fixed:<ul>
<li>A 401 Unauthorised response did not include a WWW-Authenticate header.</li>
<li>A response including both <code>Set-Cookie</code> and <code>Cache-Control</code> header
  fields would be cached even though responses containing <code>Set-Cookie</code>
  fields should not be cached.</li>
<li>The <code>cache-ignore-query-params</code> and <code>cache-whitelist-query-params</code>
  annotations did not work correctly.</li>
</ul>
</li>
<li>Improvement: The Kubernetes API code was rewritten and is now more
    reliable, more efficient, and faster to respond to changes in the
    cluster.</li>
<li>Bug fix: Several memory leaks were fixed.</li>
<li>Bug fix: TS would crash if the connection to the API server failed.</li>
<li>Bug fix: Path handling code could crash with non-default paths.</li>
<li>Bug fix: If no configuration file was specified, environment-based
    configuration would not be loaded either.</li>
<li>Bug fix: Compilation would fail if the C compiler did not enable
    C99 by default.</li>
</ul>
</li>
<li>
<p>1.0.0-alpha7:</p>
<ul>
<li>Improvement: The Traffic Server version in the Docker image has been
    upgraded from 7.0.0 to 7.1.x (prerelease).</li>
<li>Improvement: The hash tree implementation has been replaced with a radix
    tree, reducing memory use for small clusters and providing better (and
    more predictable) performance for large clusters.</li>
<li>Bug fix: A synthetic response could cause a crash.</li>
<li>Bug fix: An incorrect Cookie header could be sent to the origin.</li>
<li>Bug fix: An incorrect Content-Encoding header could be sent to the client
    if the client supported compression but the response object was not
    compressed.</li>
</ul>
</li>
<li>
<p>1.0.0-alpha6:</p>
<ul>
<li>Incompatible change: The behaviour of the <code>app-root</code> annotation was
    changed to match the behaviour of other Ingress controllers.</li>
<li>Incompatible change: Several annotations were moved from
    <code>ingress.torchbox.com</code> to <code>ingress.kubernetes.io</code> to improve
     compatibility among Ingress controllers.</li>
<li>Feature: The <code>ingress.kubernetes.io/read-response-timeout</code> annotation
    was implemented.</li>
<li>Feature: CORS annotations were implemented.</li>
<li>Feature: HTTP compression was implemented.</li>
<li>Feature: For Ingress resources with caching enabled, an <code>X-Cache-Status</code>
    header is returned in the response, indicating whether the request was
    cached and the current cache generation.</li>
<li>Feature: The <code>cache-ignore-cookies</code> annotation was implemented.</li>
<li>Bug fix: With certain combinations of OpenSSL and Traffic Server versions,
    a TLS request for an unknown host could hang indefinitely instead of
    returning an error.</li>
</ul>
</li>
<li>
<p>1.0.0-alpha5:</p>
<ul>
<li>Incompatible change: The <code>ingress.torchbox.com/auth-address-list</code>
    annotation was renamed to <code>ingress.torchbox.com/whitelist-source-range</code>,
    and is now comma-delimited, for compatibility with other Ingress
    controllers.</li>
<li>Feature: Support Ingress classes.</li>
<li>Feature: The X-Forwarded-Proto header is now (optionally) sent to the
    backend.</li>
<li>Feature: The <code>cache-whitelist-params</code> and <code>cache-ignore-params</code>
    annotations were implemented.</li>
<li>Feature: The <code>tls_verify</code> configuration option was added.</li>
<li>Improvement: The API server connection code was reimplemented using cURL,
    making it more reliable and featureful.</li>
<li>Bug fix: TLS redirects with an empty URL path could crash.</li>
<li>Bug fix: TLS secret handling could leak memory.</li>
<li>Bug fix: with some combinations of Traffic Server and OpenSSL versions,
    TLS certificates might not be loaded correctly.  Use the new
    TS_SSL_CERT_HOOK hook to ensure this works properly in all cases.</li>
<li>Bug fix: An Endpoints with more than one port or address could be parsed
    incorrectly or cause a crash.</li>
</ul>
</li>
<li>
<p>1.0.0-alpha4:</p>
<ul>
<li>Do not return a client error if the requested host or path was not
  found, to allow use with other plugins like healthchecks.</li>
</ul>
</li>
<li>
<p>1.0.0-alpha3:</p>
<ul>
<li>Greatly improved unit test coverage.</li>
<li>Several minor bugs fixed.</li>
<li>Support configuration via environment variables.</li>
</ul>
</li>
<li>
<p>1.0.0-alpha2: Implement IP address authentication.</p>
</li>
<li>1.0.0-alpha1: Initial release.</li>
</ul>
<h2 id="license-and-credits">License and credits</h2>
<p>This plugin was developed by Felicity Tarnell (ft@le-Fay.ORG) for
<a href="https://torchbox.com">Torchbox Ltd.</a>.  Copyright (c) 2016-2017 Torchbox Ltd.</p>
<p>Permission is granted to anyone to use this software for any purpose,
including commercial applications, and to alter it and redistribute it
freely. This software is provided 'as-is', without any express or implied
warranty.</p>
<hr />
<p><code>crypt_bf.c</code> was written by Solar Designer, and is released into the public
domain.</p>
<p><code>crypt_des.c</code> is copyright (c) 1989, 1993 The Regents of the University of
California, based on code written by Tom Truscott.</p>
<p><code>crypt_md5.c</code> was written by Poul-Henning Kamp, and is released under the
"beer-ware" license.</p>
<p><code>crypt_sha256.c</code> and <code>crypt_sha512.c</code> were written by Ulrich Drepper, and are
released into the public domain.</p>
<p><code>strmatch.c</code> is copyright (c) 1989, 1993, 1994 The Regents of the University
of California, based on code written by Guido van Rossum.</p>
<p><code>contrib/rax</code> is Copyright (c) 2017, Salvatore Sanfilippo <antirez at gmail dot com></p>
<p><code>contrib/brotli</code> is Copyright 2013 Google Inc.</p>
<p><code>base64.c</code> is copyright (c) 2011-2017 Felicity Tarnell.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="source/" class="btn btn-neutral float-right" title="Installing from source">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright (c) 2016-2017 Torchbox Ltd.</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/torchbox/k8s-ts-ingress" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
      
        <span style="margin-left: 15px"><a href="source/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>

<!--
MkDocs version : 0.15.3
Build Date UTC : 2017-07-02 07:22:47
-->

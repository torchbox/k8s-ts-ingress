<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>Using the Docker Image - TS Ingress Controller</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Using the Docker Image";
    var mkdocs_page_input_path = "docker.md";
    var mkdocs_page_url = "/docker/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> TS Ingress Controller</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">Home</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Installation</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../source/">Installing from source</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Using the Docker Image</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#using-the-docker-image-on-kubernetes">Using the Docker image on Kubernetes</a></li>
                
                    <li><a class="toctree-l4" href="#runtime-configuration">Runtime configuration</a></li>
                
                    <li><a class="toctree-l4" href="#cache-storage">Cache storage</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../classes/">Using multiple Ingress controllers</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../config/">Configuration</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Usage</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../annotations/">Annotations</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../caching/">Caching</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../auth/">Authentication</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../external/">External proxying</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../tls/">TLS</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../cors/">CORS</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../compression/">Compression</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">TS Ingress Controller</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Installation &raquo;</li>
        
      
    
    <li>Using the Docker Image</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/torchbox/k8s-ts-ingress" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="using-the-docker-image-on-kubernetes">Using the Docker image on Kubernetes</h1>
<p>We provide two examples Kubernetes deployments for the TS ingress controller:</p>
<ul>
<li><code>example-daemonset.yaml</code> uses a DaemonSet, with an example of using node
  taints and affinity to run the controller only on master nodes, and exposes
  TS using a hostPort;</li>
<li><code>example-deployment.yaml</code> uses a Deployment, with a nodePort Service used to
  expose TS.</li>
</ul>
<p>You will probably want to read and edit one of these files before using it.</p>
<p>Unfortunately, there are many different ways to expose an Ingress controller on
Kubernetes, and we can't document every possible variation, so you will need to
decide what method is best for your cluster.</p>
<h2 id="runtime-configuration">Runtime configuration</h2>
<p>Most Traffic Server configuration (<code>records.config</code> entries) can be changed
using environment variables; see the
<a href="https://docs.trafficserver.apache.org/en/latest/admin-guide/files/records.config.en.html#environment-overrides">Traffic Server Documentation</a>.  For example, to make Traffic Server listen on port 7080 for HTTP requests,
set <code>PROXY_CONFIG_HTTP_SERVER_PORTS=7080</code>.</p>
<p>The TS Docker image provides one additional environment variable:</p>
<ul>
<li><code>TS_CACHE_SIZE=nnn</code>: Size of the on-disk cache file to create, in megabytes.</li>
</ul>
<h2 id="cache-storage">Cache storage</h2>
<p>The example deployment resources use an <code>emptyDir</code> for cache storage.  This
means the cache will persist across node reboots, but will we cleared if the
pod is move to a different node, or if it's upgraded (which deletes the old pod).</p>
<p>The cache file will be created automatically on startup if it doesn't exist.</p>
<p>For persistent cache storage, mount a volume on <code>/var/lib/trafficserver</code>. 
However, be aware that only one instance of TS can access the cache at once.  If
you are running multiple copies, you will need to create a separate PV for each
instance (perhaps by using a StatefulSet instead of a DaemonSet).</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../classes/" class="btn btn-neutral float-right" title="Using multiple Ingress controllers">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../source/" class="btn btn-neutral" title="Installing from source"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright (c) 2016-2017 Torchbox Ltd.</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/torchbox/k8s-ts-ingress" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../source/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../classes/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
